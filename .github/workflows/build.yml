name: CI

on:
  push:

jobs:
  build:
    name: build site
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: nixbuild/nix-quick-install-action@v24
        with:
          nix_on_tmpfs: true
          nix_conf: |
            experimental-features = nix-command flakes
      - uses: nixbuild/nixbuild-action@v19
        with:
          nixbuild_token: ${{ secrets.NIXBUILD_TOKEN }}
          generate_summary_for: 'workflow'
      # - name: build site
      #   run: |
      #     nix build \
      #       --print-build-logs \
      #       --builders "" \
      #       --max-jobs 2 \
      #       --eval-store auto \
      #       --store ssh-ng://eu.nixbuild.net

      - name: build container
        run: |
          nix build \
            --json \
            --print-build-logs \
            --builders "" \
            --max-jobs 2 \
            --eval-store auto \
            --store ssh-ng://eu.nixbuild.net \
            .#container
